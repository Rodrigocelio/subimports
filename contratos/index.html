<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Cliente</title>
    <link rel="stylesheet" href="style.css"> <!-- Link para o arquivo CSS -->
</head>

<body>
    <div style="display: flex; flex-direction: column;">
        <div style="display: flex; flex-direction: column; align-items: center">
            <h2>STEP1 - INFORMAÇÕES SOBRE O CLIENTE</h2>
        </div>
        <div class="w-form-container">

            <Div class="card component-card">
                <label class="w-form-label" for="cod-cliente">Código do Cliente</label>
                <form class="w-form-wrapper" id="form-busca">
                    <input class="input icon-inside-right" type="text" id="cod-cliente" placeholder="Digite o Código">
                    <button class="btn-primary-2" type="button" id="buscar">Buscar</button>
                </form>

                <form style="padding-top: 10px;" class="w-form" id="form-cliente">
                    <label class="w-form-label" for="nome">Nome</label>
                    <input class="w-input" type="text" id="nome" placeholder="Digite o nome" required>

                    <label class="w-form-label" for="email">Email</label>
                    <input class="w-input" type="text" id="email" placeholder="Digite o email" required>

                    <label class="w-form-label" for="cpf">CPF/CNPJ</label>
                    <input class="w-input" type="text" id="cpf" placeholder="Digite o CPF/CNPJ" required>

                    <label class="w-form-label" for="celular">Celular</label>
                    <input class="w-input" type="text" id="celular" placeholder="Digite o celular" required>

                    <label class="w-form-label" for="cep">CEP</label>
                    <input class="w-input" type="text" id="cep" placeholder="Digite o CEP" required>

                    <label class="w-form-label" for="endereco">Endereço</label>
                    <input class="w-input" type="text" id="endereco" placeholder="Digite o endereço" required>

                    <label class="w-form-label" for="bairro">Bairro</label>
                    <input class="w-input" type="text" id="bairro" placeholder="Digite o bairro" required>

                    <label class="w-form-label" for="cidade">Cidade</label>
                    <input class="w-input" type="text" id="cidade" placeholder="Digite a cidade" required>

                    <label class="w-form-label" for="uf">UF</label>
                    <input class="w-input" type="text" id="uf" placeholder="Digite a UF" required>

                    <label class="w-form-label" for="data-nascimento">Data de Nascimento</label>
                    <input class="w-input" type="text" id="data-nascimento" placeholder="Digite a data de nascimento"
                        required>
                </form>
            </Div>
        </div>
    </div>

    <script>
        // URL da API do Baserow e token de autenticação
        const apiUrl = 'https://api.baserow.io/api/database/rows/table/353676/?user_field_names=true';
        const token = 's2NSZMdEQV8WwAQUW2FqZ8lnyHl14YfY';

        // Função para buscar os dados do cliente pela API do Baserow
        async function buscarDadosCliente(codCliente) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Token ${token}`,
                        'Accept': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`Erro ao buscar dados: ${response.statusText}`);
                }

                const data = await response.json();

                // Procurar o cliente com base no código fornecido
                const cliente = data.results.find(cliente => cliente.Codigo === codCliente);

                if (!cliente) {
                    alert('Cliente não encontrado.');
                    return null;
                }

                return cliente;

            } catch (error) {
                console.error(error);
                alert("Erro ao buscar os dados do cliente. Verifique o console para mais detalhes.");
                return null;
            }
        }

        // Evento para buscar o cliente ao clicar no botão
        document.getElementById('buscar').addEventListener('click', async function () {
            const codCliente = document.getElementById('cod-cliente').value.trim();

            if (codCliente === "") {
                alert("Por favor, insira um código de cliente válido.");
                return;
            }

            const cliente = await buscarDadosCliente(codCliente);
            if (cliente) {
                // Preencher os campos com os dados retornados da API
                document.getElementById('nome').value = cliente.Nome;
                document.getElementById('email').value = cliente.Email;
                document.getElementById('cpf').value = cliente.Cpf_cnpj;
                document.getElementById('celular').value = cliente.Celular;
                document.getElementById('cep').value = cliente.CEP;
                document.getElementById('endereco').value = cliente.Endereço;
                document.getElementById('bairro').value = cliente.Bairro;
                document.getElementById('cidade').value = cliente.Cidade;
                document.getElementById('uf').value = cliente.UF;
                document.getElementById('data-nascimento').value = cliente.Data_nascimento;
            }
        });
    </script>
</body>

</html>